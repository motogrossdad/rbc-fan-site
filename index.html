<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RBC Roosendaal 25/26</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#0b1020; --card:#141a2f; --accent:#ff8c00; --muted:#94a3b8; --text:#e5e7eb; }
    * { box-sizing: border-box; }
    body { margin:0; font-family:Inter,system-ui,sans-serif; background:var(--bg); color:var(--text); }
    header { position:sticky; top:0; background:rgba(11,16,32,.8); border-bottom:1px solid rgba(255,255,255,.06); z-index:10; }
    nav { max-width:1100px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; padding:.75rem 1rem; }
    .brand { font-weight:800; }
    .links a { color:var(--text); margin-left:1rem; text-decoration:none; font-weight:600; }

    .grid { display:grid; grid-template-columns:1fr; gap:1rem; max-width:1100px; margin:1rem auto; padding:0 1rem; }
    .card { background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:.8rem; padding:1rem; }
    h2 { margin:0 0 .6rem; }

    /* Teletext — balanced sizes (not tiny, not huge) */
    .tt { margin-bottom:1rem; }
    .tt .frame {
      width:100%;
      height: 60vh;            /* desktop default */
      border:0;
      border-radius:.8rem;
      background:#0e1224;
    }
    @media (max-width: 1024px) { .tt .frame { height: 55vh; } }  /* tablet */
    @media (max-width: 600px)  { .tt .frame { height: 65vh; } }  /* mobile */

    /* Fixtures list */
    .fixtures { list-style:none; padding:0; margin:0; display:grid; gap:.5rem; }
    .fixtures li { background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08); border-radius:.6rem; padding:.6rem .8rem; }

    /* Squad */
    .squad { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:.8rem; }
    .player { background:rgba(255,255,255,.05); border-radius:.6rem; padding:.6rem; text-align:center; }
    .player h3 { margin:.2rem 0 .25rem; font-size:1rem; }
    .muted { color:var(--muted); }

    footer { text-align:center; color:var(--muted); padding:1rem; }
  </style>
</head>
<body>
  <header>
    <nav>
      <div class="brand">RBC Roosendaal</div>
      <div class="links">
        <a href="#tables">Tables</a>
        <a href="#fixtures">Fixtures</a>
        <a href="#squad">Squad</a>
      </div>
    </nav>
  </header>

  <main class="grid">
    <!-- Teletext -->
    <section class="card" id="tables">
      <h2>Tables</h2>
      <div class="tt">
        <h3 style="margin:.2rem 0 .5rem; color:var(--muted);">Standings</h3>
        <iframe class="frame" src="https://teletekst-data.nos.nl/webplus?p=835-2" title="NOS Teletekst — Standings" loading="lazy"></iframe>
      </div>
      <div class="tt">
        <h3 style="margin:.2rem 0 .5rem; color:var(--muted);">Results</h3>
        <iframe class="frame" src="https://teletekst-data.nos.nl/webplus?p=835-1" title="NOS Teletekst — Results" loading="lazy"></iframe>
      </div>
    </section>

    <!-- Fixtures -->
    <section class="card" id="fixtures">
      <h2>Fixtures</h2>
      <ul id="fixtures-list" class="fixtures"></ul>
      <p id="fixtures-empty" class="muted" style="display:none">Geen wedstrijden gevonden.</p>
    </section>

    <!-- Squad -->
    <section class="card" id="squad">
      <h2>Squad</h2>
      <div class="squad" id="squad-list"></div>
    </section>
  </main>

  <footer>© <span id="year"></span> RBC Roosendaal</footer>

  <script>document.getElementById('year').textContent=new Date().getFullYear();</script>
  <script src="./assets/script.js"></script>

  <!-- ICS parser -->
  <script src="https://cdn.jsdelivr.net/npm/ical.js@1.4.0/build/ical.min.js"></script>

  <!-- Robust fixtures loader: ALWAYS pulls from your raw GitHub ICS -->
  <script>
  (async function initFixtures() {
    const list = document.getElementById('fixtures-list');
    const empty = document.getElementById('fixtures-empty');
    if (!list) return;

    const ICS_URL = "https://raw.githubusercontent.com/motogrossdad/rbc-fan-site/main/data/rbc.ics" + "?v=" + Date.now();

    const TZ = 'Europe/Amsterdam';
    const fmt = (d) => new Intl.DateTimeFormat('nl-NL', {
      weekday:'short', day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit', timeZone: TZ
    }).format(d);

    function toJsDate(t) {
      if (!t) return null;
      if (t.isDate) return new Date(Date.UTC(t.year, t.month - 1, t.day, 0, 0, 0));
      return t.toJSDate();
    }

    try {
      const res = await fetch(ICS_URL, { cache: 'no-store' });
      if (!res.ok) throw new Error('ICS HTTP ' + res.status);
      let icsText = await res.text();
      icsText = icsText.replace(/^\uFEFF/, '').replace(/\r\n/g, '\n');

      const jcal = ICAL.parse(icsText);
      const comp = new ICAL.Component(jcal);
      const items = comp.getAllSubcomponents('vevent').map(v => new ICAL.Event(v));

      const fixtures = items.map(e => ({
        start: toJsDate(e.startDate),
        end: e.endDate ? toJsDate(e.endDate) : null,
        summary: e.summary || 'Fixture',
        location: e.location || ''
      })).filter(f => f.start && !Number.isNaN(+f.start))
        .sort((a,b)=> a.start - b.start);

      list.innerHTML = '';
      if (!fixtures.length) { empty.style.display = 'block'; return; }
      empty.style.display = 'none';

      const frag = document.createDocumentFragment();
      fixtures.forEach(f => {
        const li = document.createElement('li');
        li.textContent = `${fmt(f.start)} — ${f.summary}${f.location ? ' · ' + f.location : ''}`;
        frag.appendChild(li);
      });
      list.appendChild(frag);
    } catch (e) {
      console.error('[RBC] ICS parse error', e);
      empty.textContent = 'Kon fixtures niet laden (controleer data/rbc.ics).';
      empty.style.display = 'block';
    }
  })();
  </script>
</body>
</html>
