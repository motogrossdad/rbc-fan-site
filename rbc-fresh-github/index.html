<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RBC Roosendaal 25/26</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#0b1020; --card:#141a2f; --accent:#ff8c00; --muted:#94a3b8; --text:#e5e7eb; }
    * { box-sizing: border-box; }
    body { margin:0; font-family:Inter,system-ui,sans-serif; background:var(--bg); color:var(--text); line-height:1.4; }
    header { position:sticky; top:0; backdrop-filter:saturate(180%) blur(8px); background:rgba(11,16,32,.82); border-bottom:1px solid rgba(255,255,255,.06); z-index:10; }
    nav { max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:.75rem 1rem; }
    .brand { font-weight:800; letter-spacing:.2px; }
    .links a { color:var(--text); margin-left:1rem; text-decoration:none; font-weight:600; opacity:.9 }
    .links a:hover{ opacity:1 }

    .grid { display:grid; grid-template-columns:1fr; gap:1rem; max-width:1100px; margin:1rem auto; padding:0 1rem 2rem; }
    .card { background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:.9rem; padding:1rem; }
    h2 { margin:0 0 .7rem; }
    h3 { margin:1rem 0 .5rem; font-size:1rem; opacity:.95 }

    /* Teletext viewport: tidy sizing and full width, but not overwhelming */
    .iframe-viewport { width:100%; height:60vh; border-radius:.8rem; background:#0e1224; border:0; overflow:hidden; }
    .iframe-viewport iframe { width:100%; height:100%; border:0; }
    @media(max-width:720px){ .iframe-viewport{ height:58vh; } }
    @media(max-width:480px){ .iframe-viewport{ height:52vh; } }

    /* Fixtures */
    .fixtures { list-style:none; padding:0; margin:0; display:grid; gap:.5rem; }
    .fixtures li { background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08); border-radius:.6rem; padding:.6rem .8rem; }
    .fixture-title { font-weight:600 }
    .muted { color:var(--muted); }

    /* Squad */
    .squad { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:.8rem; }
    .player { background:rgba(255,255,255,.05); border-radius:.6rem; padding:.6rem; text-align:center; }
    .player h3 { margin:.2rem 0 .25rem; font-size:1rem; }
  </style>
</head>
<body>
  <header>
    <nav>
      <div class="brand">RBC Roosendaal</div>
      <div class="links">
        <a href="#tables">Stand</a>
        <a href="#fixtures">Programma</a>
        <a href="#squad">Selectie</a>
      </div>
    </nav>
  </header>

  <main class="grid">
    <section class="card" id="tables">
      <h2>Tables</h2>
      <h3>Stand</h3>
      <div class="iframe-viewport">
        <iframe src="https://teletekst-data.nos.nl/webplus?p=835-2" title="NOS Teletekst — Stand" loading="lazy" referrerpolicy="no-referrer"></iframe>
      </div>
      <h3>Uitslagen</h3>
      <div class="iframe-viewport">
        <iframe src="https://teletekst-data.nos.nl/webplus?p=835-1" title="NOS Teletekst — Uitslagen" loading="lazy" referrerpolicy="no-referrer"></iframe>
      </div>
    </section>

    <section class="card" id="fixtures">
      <h2>Programma</h2>
      <ul id="fixtures-list" class="fixtures"></ul>
      <p id="fixtures-empty" class="muted" style="display:none">Geen wedstrijden gevonden.</p>
    </section>

    <section class="card" id="squad">
      <h2>Selectie</h2>
      <div class="squad" id="squad-list"></div>
      <p id="squad-empty" class="muted" style="display:none">Nog geen spelers toegevoegd.</p>
    </section>
  </main>

  <footer style="text-align:center; color:var(--muted); padding:1rem;">© <span id="year"></span> RBC Roosendaal</footer>

  <script>document.getElementById('year').textContent=new Date().getFullYear();</script>
  <script src="https://cdn.jsdelivr.net/npm/ical.js@1.4.0/build/ical.min.js"></script>
  <script src="./assets/script.js"></script>
  <script>
  // ---- Fixtures (ICS) ----
  (async function initFixtures() {
    const list = document.getElementById('fixtures-list');
    const empty = document.getElementById('fixtures-empty');
    const TZ = 'Europe/Amsterdam';

    function fmt(d){
      return new Intl.DateTimeFormat('nl-NL', {
        weekday:'short', day:'2-digit', month:'short',
        hour:'2-digit', minute:'2-digit', timeZone: TZ
      }).format(d);
    }

    function toJsDate(t){
      if (!t) return null;
      if (t.isDate) return new Date(Date.UTC(t.year, t.month-1, t.day, 0, 0, 0));
      return t.toJSDate();
    }

    async function fetchText(url) {
      const res = await fetch(url, { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      return res.text();
    }

    const localUrl = new URL('./data/rbc.ics', location.href).href + '?v=' + Date.now();

    let icsText = '';
    try { icsText = await fetchText(localUrl); }
    catch (e) {
      console.warn('[RBC] Calendar load failed:', e);
      empty.style.display='block';
      empty.textContent = 'Kon kalender niet laden.';
      return;
    }

    icsText = icsText.replace(/^\uFEFF/, '').replace(/\r\n/g, '\n');
    try {
      const jcal = ICAL.parse(icsText);
      const comp = new ICAL.Component(jcal);
      const items = comp.getAllSubcomponents('vevent').map(v => new ICAL.Event(v));
      const fixtures = items.map(e => ({
        start: toJsDate(e.startDate),
        end: e.endDate ? toJsDate(e.endDate) : null,
        summary: e.summary || 'Wedstrijd',
        location: e.location || ''
      })).filter(f => f.start && !Number.isNaN(+f.start));

      fixtures.sort((a,b)=> a.start - b.start);
      if (!fixtures.length) { empty.style.display='block'; return; }

      const frag = document.createDocumentFragment();
      fixtures.forEach(f => {
        const li = document.createElement('li');
        const title = document.createElement('div');
        title.className='fixture-title';
        title.textContent = f.summary;
        const meta = document.createElement('div');
        meta.className='muted';
        meta.textContent = `${fmt(f.start)}${f.location ? ' · ' + f.location : ''}`;
        li.appendChild(title);
        li.appendChild(meta);
        frag.appendChild(li);
      });
      list.appendChild(frag);
    } catch (e) {
      console.error('[RBC] ICS parse error', e);
      empty.textContent = 'Kon fixtures niet verwerken (controleer data/rbc.ics).';
      empty.style.display = 'block';
    }
  })();
  </script>
</body>
</html>
